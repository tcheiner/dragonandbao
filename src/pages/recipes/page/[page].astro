---
import { getCollection } from 'astro:content';
import IndexPageLayout from "../../../layouts/IndexPageLayout.astro";
import ProjectCard from '../../../components/ProjectCard.astro'

export async function getStaticPaths({ paginate }) {
  const allRecipes = await getCollection('recipes');
  
  // Sort by date
  allRecipes.sort((a, b) => {
    return new Date(b.data.startDate) - new Date(a.data.startDate);
  });
  
  // Generate pages with 16 items per page (4x4 grid)
  return paginate(allRecipes, { pageSize: 16 });
}

const { page } = Astro.props;
const totalPages = page.lastPage;
const currentPage = page.currentPage;
---

<IndexPageLayout title="Recipes" description="Browse our delicious recipes" subTitle="Dragon & Bao Recipes">
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
        {
            page.data.map((entity: any) => (
                <ProjectCard
                    class=""
                    key={entity.data.title}
                    href={'/recipes/' + entity.slug}
                    heading={entity.data.title}
                    subheading={entity.data.description}
                    altText={entity.data?.image?.alt}
                    imagePath={entity.data?.image?.url}
                    dateStart={entity.data.startDate}
                />
            ))
        }
    </div>

    {/* Pagination */}
    <div class="flex justify-center mt-8 space-x-2">
        {
            Array.from({ length: totalPages }).map((_, i) => (
                <a 
                    href={i === 0 ? '/recipes' : `/recipes/page/${i + 1}`}
                    class={`px-4 py-2 rounded-md ${currentPage === i + 1 ? 'bg-aquamarine-blue-400 text-white' : 'bg-gray-200 text-gray-700'}`}
                >
                    {i + 1}
                </a>
            ))
        }
    </div>
</IndexPageLayout>
