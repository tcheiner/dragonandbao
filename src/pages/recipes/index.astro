---
import { getCollection } from 'astro:content';
import IndexPageLayout from "../../layouts/IndexPageLayout.astro";
import ProjectCard from '../../components/ProjectCard.astro'

// Get all recipes
const allRecipes = await getCollection('recipes');

// Sort by date if available, otherwise by title
allRecipes.sort((a: any, b: any) => {
    if (a.data.startDate && b.data.startDate) {
        return new Date(b.data.startDate) - new Date(a.data.startDate);
    }
    return a.data.title.localeCompare(b.data.title);
});

// Pagination
const recipesPerPage = 16; // 4x4 grid
const currentPage = 1;
const totalPages = Math.ceil(allRecipes.length / recipesPerPage);
const recipes = allRecipes.slice(0, recipesPerPage);
---

<IndexPageLayout title="Recipes" description="Browse our delicious recipes" subTitle="Dragon & Bao Recipes">
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
        {
            recipes.map((entity: any) => (
                <ProjectCard
                    class=""
                    key={entity.data.title}
                    href={'/recipes/' + entity.slug}
                    heading={entity.data.title}
                    subheading={entity.data.description}
                    altText={entity.data?.image?.alt}
                    imagePath={entity.data?.image?.url}
                    dateStart={entity.data.startDate}
                />
            ))
        }
    </div>

    {/* Pagination */}
    <div class="flex justify-center mt-8 space-x-2">
        {
            Array.from({ length: totalPages }).map((_, i) => (
                <a 
                    href={i === 0 ? '/recipes' : `/recipes/page/${i + 1}`}
                    class={`px-4 py-2 rounded-md ${currentPage === i + 1 ? 'bg-aquamarine-blue-400 text-white' : 'bg-gray-200 text-gray-700'}`}
                >
                    {i + 1}
                </a>
            ))
        }
    </div>
</IndexPageLayout>

